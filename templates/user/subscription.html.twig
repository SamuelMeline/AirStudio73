{% extends 'base.html.twig' %}

{% block body %}
	<div class="container">
		<h1>Mes Forfaits</h1>
		<div class="list-group">
			{% set allSubscriptionsEmpty = true %}
			{% for subscription in subscriptions %}
				{% set hasCredits = false %}
				{% set isExpired = subscription.expiryDate < date() %}
				{% set isNotStarted = subscription.startDate > date() %}

				{% for subscriptionCourse in subscription.subscriptionCourses %}
					{% if subscriptionCourse.remainingCredits > 0 %}
						{% set hasCredits = true %}
						{% set allSubscriptionsEmpty = false %}
					{% endif %}
				{% endfor %}

				<div class="list-group-item">
					<h5 class="mb-1">{{ subscription.plan.name }}</h5>
					<ul class="list-unstyled">
						{% for subscriptionCourse in subscription.subscriptionCourses %}
							<li>
								{{ subscriptionCourse.course.name }}
								-
								{{ subscriptionCourse.remainingCredits }}
								crédits
							</li>
						{% endfor %}
					</ul>
					<p class="mb-1">Date de commencement :
						{{ subscription.startDate|date('d-m-Y') }}</p>
					<p class="mb-1">Date d'expiration :
						{{ subscription.expiryDate|date('d-m-Y') }}</p>
					<p class="mb-1">Mode de paiement :
						{{ subscription.paymentMode }}</p>

					{% if isExpired %}
						<p class="text-danger">Ce forfait a expiré.</p>
					{% elseif isNotStarted %}
						<p class="text-warning">Ce forfait vous permet de réserver des cours à partir du {{ subscription.startDate|date('d-m-Y') }}.</p>
					{% elseif hasCredits %}
						<a href="{{ path('calendar') }}" class="btn btn-primary btn-sm">Réserver</a>
					{% else %}
						<p class="text-danger">Pas de crédits restants</p>
					{% endif %}
				</div>
			{% endfor %}

			{% if allSubscriptionsEmpty %}
				<div class="alert alert-warning mt-3" role="alert">
					Vous n'avez aucun crédit restant sur vos forfaits.
				</div>
			{% endif %}
			<a href="{{ path('subscription_new') }}" class="btn btn-success btn-sm">Acheter un nouveau forfait</a>
		</div>
	</div>
{% endblock %}
